#!/bin/bash

set -e

DOTFILES=~/dotfiles
echo "Installing $DOTFILES"

if [ ! -d $DOTFILES ]; then
  echo "Cloning dotfiles repo"

  remote="https://github.com/apeduru/dotfiles.git"
  if [[ -n "${TOKEN}" ]]; then
    token="${TOKEN}"@
    remote="https://"$token"github.com/apeduru/dotfiles.git"
  fi

  git clone "$remote" "$DOTFILES"
else
  echo "$DOTFILES already exists"
  exit 1
fi

cd $DOTFILES

if [ "$(uname -s)" == "Darwin"  ]; then
  if  [ ! -e $(which brew) ]; then
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  fi
  brew update
  brew bundle

  make up
else
  sudo apt update
  cat $DOTFILES/packages.list | xargs sudo apt-get --yes install
fi

exit 0
