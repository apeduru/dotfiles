#!/bin/bash

set -e

DOTFILES=~/dotfiles
echo "Installing $DOTFILES"

if [ ! -d $DOTFILES ]; then
  echo "Cloning dotfiles repo"

  url="https://"
  if [[ -n "${TOKEN}" ]]; then
    url=""$url""${TOKEN}"@"
  fi
  repo=""$url"github.com/apeduru/dotfiles.git"

  git clone "$repo" "$DOTFILES"
else
  echo "$DOTFILES already exists"
  exit 1
fi

cd $DOTFILES

case "$(uname -s)" in 
  Darwin)
    if  [ ! -e $(which brew) ]; then
      /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    fi
    brew update
    brew bundle

    make up
    ;;
  Linux)
    sudo apt update
    cat $DOTFILES/packages.list | xargs sudo apt-get --yes install

    make up
    ;;
  *)
    echo "Unrecognized OS. Exiting."
    exit 1
    ;;
esac

exit 0
